<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Website Scraper + Chatbot</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Inter', sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px; }

.container { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); width: 600px; max-width: 95%; }

h1 { text-align: center; margin-bottom: 25px; color: #111827; }
.input-group { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
input { flex: 1; padding: 12px 16px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; transition: 0.2s; }
input:focus { outline: none; border-color: #6366f1; box-shadow: 0 0 0 2px rgba(99,102,241,0.2); }

button, .chatbot-btn { padding: 12px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; }
button { background: #6366f1; color: #fff; }
button:hover { background: #4f46e5; }

.chatbot-btn { display: block; width: 100%; margin-top: 20px; text-align: center; background: #10b981; color: #fff; text-decoration: none; pointer-events: none; opacity: 0.6; }
.chatbot-btn.enabled { pointer-events: auto; opacity: 1; }
.chatbot-btn:hover { background: #059669; }

#status { margin-bottom: 15px; font-weight: 500; color: #374151; min-height: 20px; display: flex; align-items: center; gap: 10px; }
.loader { border: 4px solid #f3f3f3; border-top: 4px solid #6366f1; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; display: inline-block; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

.progress-container { width: 100%; background: #e5e7eb; border-radius: 10px; overflow: hidden; margin-bottom: 15px; display: none; }
.progress-bar { width: 0%; height: 12px; background: #6366f1; transition: width 0.5s ease; }

pre { background: #f9fafb; padding: 20px; border-radius: 10px; border: 1px solid #e5e7eb; max-height: 300px; overflow: auto; font-size: 14px; white-space: pre-wrap; word-wrap: break-word; }

@media(max-width: 650px){
  .input-group { flex-direction: column; }
  button, .chatbot-btn { width: 100%; }
}
</style>
</head>
<body>

<div class="container">
    <h1>Website Scraper</h1>
    <div class="input-group">
        <input type="text" id="urlInput" placeholder="Enter website URL here..." />
        <button id="scrapeBtn">Scrape</button>
    </div>
    <div id="status"></div>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <pre id="preview"></pre>
    <a href="/chat" id="chatbotBtn" class="chatbot-btn">Start your chatbot now ...</a>
</div>

<script>
const statusEl = document.getElementById("status");
const previewEl = document.getElementById("preview");
const chatbotBtn = document.getElementById("chatbotBtn");
const progressContainer = document.querySelector(".progress-container");
const progressBar = document.getElementById("progressBar");

chatbotBtn.addEventListener("click", (e) => {
    const scrapedData = localStorage.getItem("scrapedData");
    if(!scrapedData){
        e.preventDefault();
        alert("Please scrape a website first!");
    }
});

document.getElementById("scrapeBtn").addEventListener("click", async () => {
    const url = document.getElementById("urlInput").value.trim();
    if (!url) { alert("Please enter a URL!"); return; }

    statusEl.innerHTML = '<span class="loader"></span> Scraping in progress...';
    previewEl.textContent = "";
    progressContainer.style.display = "block";
    progressBar.style.width = "0%";

    const formData = new FormData();
    formData.append("url", url);

    let progress = 0;
    const steps = [20, 40, 60, 80];
    let index = 0;

    const fakeProgress = setInterval(() => {
        if(index < steps.length){
            progressBar.style.width = steps[index] + "%";
            index++;
        }
    }, 1000);

    try {
        const response = await fetch("http://127.0.0.1:8001/scrape", { method: "POST", body: formData });
        const data = await response.json();

        clearInterval(fakeProgress);
        progressBar.style.width = "100%";

        if(data.status === "success"){
            statusEl.textContent = "Scraping complete!";
            previewEl.textContent = JSON.stringify(data.cleaned_data_preview, null, 2);

            localStorage.setItem("scrapedData", JSON.stringify(data.cleaned_data_preview));
            chatbotBtn.classList.add("enabled");

            setTimeout(() => {
                window.location.href = "/chat";
            }, 2000);

        } else {
            statusEl.textContent = "Error: " + data.message;
            progressContainer.style.display = "none";
        }
    } catch(err){
        clearInterval(fakeProgress);
        statusEl.textContent = "Fetch error: " + err;
        progressContainer.style.display = "none";
    }
});

setInterval(async () => {
    const scrapedData = localStorage.getItem("scrapedData");
    if(scrapedData){
        previewEl.textContent = JSON.stringify(JSON.parse(scrapedData), null, 2);
    }
}, 3000);
</script>

</body>
</html>
